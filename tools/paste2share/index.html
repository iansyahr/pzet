<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paste & Share Gambar</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Animasi loading sederhana */
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-slate-100 min-h-screen flex items-center justify-center p-4 text-slate-800 font-sans">

    <div class="max-w-md w-full bg-white rounded-2xl shadow-xl overflow-hidden border border-slate-200">
        <!-- Header -->
        <div class="bg-blue-600 p-6 text-center">
            <h1 class="text-2xl font-bold text-white mb-1">Paste & Share</h1>
            <p class="text-blue-100 text-sm">Tempel gambar, langsung bagikan.</p>
        </div>

        <!-- Main Content -->
        <div class="p-6 flex flex-col items-center space-y-6">

            <!-- Paste Area / Status -->
            <div id="dropZone" class="w-full border-2 border-dashed border-slate-300 rounded-xl p-8 text-center transition-all duration-300 hover:border-blue-400 hover:bg-blue-50 group cursor-pointer">
                <div class="flex flex-col items-center justify-center space-y-3 pointer-events-none">
                    <!-- Icon -->
                    <div class="p-3 bg-blue-100 text-blue-600 rounded-full group-hover:scale-110 transition-transform">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" />
                        </svg>
                    </div>
                    <div class="text-slate-500 font-medium group-hover:text-blue-600">
                        Tekan <span class="bg-slate-200 px-2 py-0.5 rounded text-slate-700 text-sm font-mono">Ctrl + V</span> di sini
                    </div>
                    <p class="text-xs text-slate-400">Atau gunakan tombol di bawah</p>
                </div>
            </div>

            <!-- Paste Button (Mobile Friendly) -->
            <button id="btnPaste" class="w-full bg-slate-800 hover:bg-slate-700 text-white font-semibold py-3 px-4 rounded-lg flex items-center justify-center gap-2 transition-colors active:scale-95">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3" />
                </svg>
                Paste dari Clipboard
            </button>

            <!-- Status Message -->
            <div id="statusMsg" class="hidden w-full text-center text-sm font-medium p-2 rounded-lg"></div>

            <!-- Preview & Manual Share Section (Hidden initially) -->
            <div id="previewSection" class="w-full hidden flex-col items-center space-y-4 animate-fade-in-up">
                <div class="relative w-full rounded-lg overflow-hidden border border-slate-200 shadow-sm bg-slate-50">
                    <img id="imagePreview" src="" alt="Preview" class="w-full h-auto object-contain max-h-64">
                    <div class="absolute top-2 right-2 bg-black/50 text-white text-xs px-2 py-1 rounded backdrop-blur-sm">
                        Siap Dibagikan
                    </div>
                </div>
                
                <button id="btnShareManual" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg flex items-center justify-center gap-2 shadow-lg shadow-green-200 transition-all active:scale-95">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" />
                    </svg>
                    Bagikan Sekarang
                </button>
            </div>

        </div>
        
        <!-- Footer -->
        <div class="bg-slate-50 p-4 border-t border-slate-200 text-center text-xs text-slate-400">
            Mendukung WhatsApp, Telegram, dll.
        </div>
    </div>

    <script>
        const dropZone = document.getElementById('dropZone');
        const btnPaste = document.getElementById('btnPaste');
        const previewSection = document.getElementById('previewSection');
        const imagePreview = document.getElementById('imagePreview');
        const statusMsg = document.getElementById('statusMsg');
        const btnShareManual = document.getElementById('btnShareManual');

        let currentFile = null;

        // Fungsi untuk menampilkan pesan status
        function showStatus(msg, type = 'info') {
            statusMsg.textContent = msg;
            statusMsg.classList.remove('hidden', 'text-red-500', 'text-green-500', 'text-blue-500', 'bg-red-50', 'bg-green-50', 'bg-blue-50');
            
            if (type === 'error') {
                statusMsg.classList.add('text-red-600', 'bg-red-50');
            } else if (type === 'success') {
                statusMsg.classList.add('text-green-600', 'bg-green-50');
            } else {
                statusMsg.classList.add('text-blue-600', 'bg-blue-50');
            }
            statusMsg.classList.remove('hidden');
        }

        // Fungsi utama untuk memproses File Gambar
        async function handleImageFile(file) {
            if (!file || !file.type.startsWith('image/')) {
                showStatus('Yang dipaste bukan gambar!', 'error');
                return;
            }

            showStatus('Gambar terdeteksi, memproses...', 'info');
            currentFile = file;

            // 1. Tampilkan Preview
            const reader = new FileReader();
            reader.onload = (e) => {
                imagePreview.src = e.target.result;
                previewSection.classList.remove('hidden');
                previewSection.classList.add('flex');
            };
            reader.readAsDataURL(file);

            // 2. Coba Auto-Share
            // Catatan: Beberapa browser memblokir share otomatis tanpa klik tombol langsung.
            // Kita coba, jika gagal, user bisa klik tombol manual.
            try {
                await performShare(file);
            } catch (err) {
                console.log("Auto-share mungkin diblokir, menunggu input manual user.", err);
                showStatus('Silakan klik tombol "Bagikan Sekarang" di bawah', 'success');
            }
        }

        // Fungsi Share menggunakan Web Share API
        async function performShare(file) {
            if (!navigator.canShare) {
                showStatus('Browser ini tidak mendukung fitur Share API.', 'error');
                return;
            }

            const shareData = {
                files: [file],
                title: 'Gambar Tempelan',
                text: 'Berikut gambar yang saya paste.'
            };

            if (navigator.canShare(shareData)) {
                try {
                    await navigator.share(shareData);
                    showStatus('Berhasil membuka menu share!', 'success');
                } catch (err) {
                    if (err.name !== 'AbortError') {
                        showStatus('Gagal membagikan: ' + err.message, 'error');
                    } else {
                        // User menutup share sheet
                        showStatus('Berbagi dibatalkan.', 'info');
                    }
                    throw err; // Lempar error agar bisa ditangkap caller
                }
            } else {
                showStatus('Browser menolak berbagi tipe file ini.', 'error');
            }
        }

        // --- Event Listeners ---

        // 1. Paste via Keyboard (Ctrl+V)
        document.addEventListener('paste', (event) => {
            const items = (event.clipboardData || event.originalEvent.clipboardData).items;
            let blob = null;

            for (const item of items) {
                if (item.type.indexOf('image') === 0) {
                    blob = item.getAsFile();
                    // Kita buat file baru agar namanya rapi saat dikirim
                    const file = new File([blob], "paste_image_" + Date.now() + ".png", { type: blob.type });
                    handleImageFile(file);
                    break;
                }
            }

            if (!blob) {
                showStatus('Tidak ada gambar di clipboard.', 'error');
            }
        });

        // 2. Paste via Tombol (untuk Mobile/Touch)
        btnPaste.addEventListener('click', async () => {
            try {
                showStatus('Membaca clipboard...', 'info');
                
                // Meminta izin baca clipboard
                const clipboardItems = await navigator.clipboard.read();
                
                let foundImage = false;

                for (const clipboardItem of clipboardItems) {
                    // Cari tipe gambar
                    const imageType = clipboardItem.types.find(type => type.startsWith('image/'));
                    
                    if (imageType) {
                        const blob = await clipboardItem.getType(imageType);
                        const file = new File([blob], "paste_image_" + Date.now() + ".png", { type: imageType });
                        handleImageFile(file);
                        foundImage = true;
                        break; 
                    }
                }

                if (!foundImage) {
                    showStatus('Clipboard kosong atau tidak berisi gambar.', 'error');
                }

            } catch (err) {
                console.error(err);
                showStatus('Gagal membaca clipboard. Pastikan Anda memberi izin atau gunakan Ctrl+V.', 'error');
            }
        });

        // 3. Tombol Share Manual (Jika auto-share gagal atau ingin share ulang)
        btnShareManual.addEventListener('click', () => {
            if (currentFile) {
                performShare(currentFile);
            }
        });

        // Efek visual klik pada dropzone
        dropZone.addEventListener('click', () => {
            // Memberi feedback visual agar user tahu area ini aktif
            dropZone.classList.add('bg-blue-100', 'border-blue-400');
            setTimeout(() => {
                dropZone.classList.remove('bg-blue-100', 'border-blue-400');
            }, 200);
            showStatus('Silakan tekan Ctrl + V', 'info');
        });

    </script>
</body>
</html>
