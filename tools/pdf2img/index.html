<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Konverter PDF ke PNG</title>
    
    <!-- Memuat pustaka PDF.js dari CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    <script>
        // Penting: Memberitahu pdf.js di mana file 'worker' berada
        pdfjsLib.GlobalWorkerOptions.workerSrc = `https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js`;
    </script>

    <style>
        /* CSS untuk tampilan */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f0f2f5;
            color: #333;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
        }

        .container {
            width: 100%;
            max-width: 900px;
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            padding: 25px;
            box-sizing: border-box;
        }

        h1 {
            text-align: center;
            color: #1a73e8;
            margin-bottom: 25px;
        }

        .upload-area {
            text-align: center;
            border: 2px dashed #ccc;
            padding: 30px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        input[type="file"] {
            display: none;
        }

        .upload-label {
            cursor: pointer;
            background-color: #1a73e8;
            color: white;
            padding: 12px 20px;
            border-radius: 6px;
            font-weight: bold;
            transition: background-color 0.3s;
        }

        .upload-label:hover {
            background-color: #155ab6;
        }
        
        #file-name {
            display: block;
            margin-top: 15px;
            font-style: italic;
            color: #555;
        }

        #status {
            text-align: center;
            margin: 20px 0;
            font-weight: 500;
            min-height: 20px;
            color: #d9534f;
        }

        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #1a73e8;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
            display: none; /* Sembunyikan secara default */
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }


        #image-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .image-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            background-color: #fafafa;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .image-card img {
            max-width: 100%;
            height: auto;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        
        .image-card .page-number {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 10px;
        }

        .copy-button {
            width: 100%;
            padding: 10px;
            border: none;
            background-color: #28a745;
            color: white;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s, transform 0.1s;
        }

        .copy-button:hover {
            background-color: #218838;
        }
        
        .copy-button:active {
            transform: scale(0.98);
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Konverter PDF ke Gambar PNG</h1>
        
        <div class="upload-area">
            <label for="pdf-upload" class="upload-label">Pilih File PDF</label>
            <input type="file" id="pdf-upload" accept=".pdf">
            <span id="file-name">Belum ada file yang dipilih</span>
        </div>
        
        <div id="status"></div>
        <div class="loader" id="loader"></div>

        <div id="image-container">
            <!-- Gambar yang dikonversi akan muncul di sini -->
        </div>
    </div>

    <script>
        // Mengambil elemen dari DOM
        const pdfUpload = document.getElementById('pdf-upload');
        const statusEl = document.getElementById('status');
        const imageContainer = document.getElementById('image-container');
        const loader = document.getElementById('loader');
        const fileNameEl = document.getElementById('file-name');

        // Menambahkan event listener ke input file
        pdfUpload.addEventListener('change', handleFileSelect);

        /**
         * Menangani pemilihan file oleh pengguna
         */
        function handleFileSelect(event) {
            const file = event.target.files[0];
            
            // Membersihkan tampilan sebelumnya
            imageContainer.innerHTML = '';
            statusEl.textContent = '';

            if (!file) {
                fileNameEl.textContent = "Belum ada file yang dipilih";
                return;
            }

            if (file.type !== 'application/pdf') {
                statusEl.textContent = 'Error: Tolong pilih file dengan format PDF.';
                fileNameEl.textContent = "File tidak valid";
                return;
            }

            fileNameEl.textContent = `File dipilih: ${file.name}`;
            
            const reader = new FileReader();
            reader.onload = function() {
                // Setelah file dibaca, mulai proses render PDF
                const typedarray = new Uint8Array(this.result);
                renderPdf(typedarray);
            };
            reader.readAsArrayBuffer(file);
        }

        /**
         * Merender setiap halaman PDF menjadi gambar PNG
         * @param {Uint8Array} pdfData - Data PDF dalam bentuk array byte
         */
        async function renderPdf(pdfData) {
            loader.style.display = 'block';
            statusEl.textContent = 'Memuat PDF...';
            
            try {
                // Memuat dokumen PDF
                const loadingTask = pdfjsLib.getDocument({ data: pdfData });
                const pdf = await loadingTask.promise;
                
                statusEl.textContent = `Total ${pdf.numPages} halaman ditemukan. Memproses...`;
                
                // Loop untuk setiap halaman
                for (let i = 1; i <= pdf.numPages; i++) {
                    statusEl.textContent = `Memproses halaman ${i} dari ${pdf.numPages}...`;
                    
                    const page = await pdf.getPage(i);
                    
                    // Atur skala untuk kualitas gambar yang lebih baik (misal: 2x resolusi asli)
                    const scale = 10.0;
                    const viewport = page.getViewport({ scale });
                    
                    // Buat elemen canvas
                    const canvas = document.createElement('canvas');
                    const context = canvas.getContext('2d');
                    canvas.height = viewport.height;
                    canvas.width = viewport.width;
                    
                    // Render halaman ke canvas
                    const renderContext = {
                        canvasContext: context,
                        viewport: viewport
                    };
                    await page.render(renderContext).promise;
                    
                    // Konversi canvas ke format PNG Data URL
                    const pngUrl = canvas.toDataURL('image/png');
                    
                    // Tampilkan gambar di halaman
                    displayImage(pngUrl, i);
                }
                
                statusEl.textContent = 'Konversi selesai!';

            } catch (error) {
                console.error('Error saat memproses PDF:', error);
                statusEl.textContent = 'Gagal memproses PDF. Silakan coba file lain.';
            } finally {
                loader.style.display = 'none'; // Sembunyikan loader setelah selesai
            }
        }

        /**
         * Membuat dan menampilkan kartu gambar di container
         * @param {string} pngUrl - Data URL dari gambar PNG
         * @param {number} pageNum - Nomor halaman
         */
        function displayImage(pngUrl, pageNum) {
            const card = document.createElement('div');
            card.className = 'image-card';

            const pageNumber = document.createElement('div');
            pageNumber.className = 'page-number';
            pageNumber.textContent = `Halaman ${pageNum}`;

            const img = document.createElement('img');
            img.src = pngUrl;
            img.alt = `Halaman ${pageNum} dari PDF`;

            const button = document.createElement('button');
            button.className = 'copy-button';
            button.textContent = 'Salin ke Clipboard';
            
            // Tambahkan event listener untuk menyalin gambar
            button.onclick = () => copyImageToClipboard(pngUrl, button);
            
            card.appendChild(pageNumber);
            card.appendChild(img);
            card.appendChild(button);
            imageContainer.appendChild(card);
        }

        /**
         * Menyalin gambar ke clipboard menggunakan Clipboard API
         * @param {string} pngUrl - Data URL dari gambar PNG
         * @param {HTMLElement} button - Elemen tombol yang diklik
         */
        async function copyImageToClipboard(pngUrl, button) {
            if (!navigator.clipboard || !navigator.clipboard.write) {
                statusEl.textContent = "Browser Anda tidak mendukung penyalinan gambar ke clipboard.";
                return;
            }
            
            try {
                // Mengubah Data URL menjadi Blob agar bisa disalin
                const response = await fetch(pngUrl);
                const blob = await response.blob();
                
                // Membuat item clipboard
                const item = new ClipboardItem({ 'image/png': blob });
                
                // Menulis item ke clipboard
                await navigator.clipboard.write([item]);
                
                // Memberikan feedback visual kepada pengguna
                const originalText = button.textContent;
                button.textContent = 'Tersalin!';
                button.style.backgroundColor = '#17a2b8';
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.style.backgroundColor = '#28a745';
                }, 2000);

            } catch (error) {
                console.error('Gagal menyalin gambar:', error);
                statusEl.textContent = 'Gagal menyalin gambar. Pastikan Anda memberikan izin.';
            }
        }
    </script>

</body>
</html>
